(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{545:function(t,s,n){"use strict";n.r(s);var a=n(6),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"nginx-离线安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-离线安装"}},[t._v("#")]),t._v(" nginx 离线安装")]),t._v(" "),n("p",[t._v("规则\nnginx 启动进程可以在 conf 里指定 user（user  work;）但是这个只有在用 root 启动的情况有意义，\n如果是用其他用户启动的 nginx master 是没有意义的 nginx 会忽略这个配置，如下 nginx warning 所述")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("nginx: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("warn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" the "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),t._v(" directive makes sense only "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" the master process runs with super-user privileges, ignored "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /home/work/app/nginx/conf/nginx.conf:1\n")])])]),n("p",[t._v("结论\n1，在非 root 账户下启动时，nignx 的 master 和 worker 进程的 owner 都将是这个账户，\n2，在 root 账户下启动时 nignx 的 master 进程是的 owner 是 root，worker 的 owner 在 conf 已配置用户的情况下，owner 是配置的用户，否则将是 nobody，而且也可能导致 nginx 的一些文件的 owner 也是 nobody")]),t._v(" "),n("h2",{attrs:{id:"nginx-安装及配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-安装及配置"}},[t._v("#")]),t._v(" nginx 安装及配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("//进入目录\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /root")]),t._v("\n// 安装openssl  如果不需要https，就不需要装openssl，可跳过\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tar -zxvf openssl-1.1.1.tar.gz")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd openssl-1.1.1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./config && make && make install")]),t._v("\n// 安装zlib\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd ..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tar -zxvf zlib-1.2.11.tar.gz")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd zlib-1.2.11")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./configure && make && make install")]),t._v("\n// 安装prce\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd ..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tar -zxvf pcre-8.38.gz")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd pcre-8.38")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./configure && make && make install")]),t._v("\n//安装nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tar -zxvf nginx-1.14.0.tar.gz")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd nginx-1.14.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./configure --prefix=/usr/local/nginx --with-pcre=../pcre-8.38 --with-zlib=../zlib-1.2.11 --with-openssl=../openssl-1.1.1 --with-poll_module --with-http_stub_status_module --with-http_ssl_module")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# make && make install")]),t._v("\n// 验证nginx安装是否安装完成\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /usr/local/nginx")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./nginx -v")]),t._v("\n\n// nginx基本命令\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动 进入sbin目录，输入命令 ./nginx")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止 ./nginx -s stop")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启./nginx -s reload")]),t._v("\n")])])]),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/tian330726/article/details/99445978",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文档"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("//如果当前服务器没有安装 gcc，则需要执行以下步骤\n1、安装包存放目录：128.0.97.34/tools/gcc-c++-4.8.5.tar.gz")]),t._v(" "),n("p",[t._v("2、 复制安装包到 root 目录下\n3、 解压： tar -zxf gcc-c++-4.8.5.tar.gz\n4、 进入解压后的文件夹执行命令 rpm -Uvh *.rpm --nodeps –force\n5、 查看安装结果： gcc -v\n"),n("a",{attrs:{href:"https://www.jianshu.com/p/d4eec4964dc5",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文档"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#user caec;")]),t._v("\nworker_processes "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nerror_log /home/ap/caec/logs/nginx/error.log error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid /home/ap/caec/nginx/logs/nginx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  worker_connections "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  include mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  default_type application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  log_format main "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(" - "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user")]),t._v(" ["),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v("] - "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$upstream_addr")]),t._v(' "'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),t._v("\" '")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(' "'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v("\" '")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\""),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v('" "'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for")]),t._v('"         '),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_time")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$upstream_response_time")]),t._v("'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  access_log /home/ap/caec/logs/nginx/access.log main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  sendfile on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  keepalive_timeout 60s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  client_max_body_size 100M"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  client_body_buffer_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  fastcgi_intercept_errors on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  upstream dynamic "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.100")]),t._v(".67.148:8101"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.100")]),t._v(".67.149:8101"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8088")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy_set_header            Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      proxy_set_header            X-real-ip "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      proxy_set_header            X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      root /home/ap/caec/caec_static"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      index index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      if"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" ~* .*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?:htm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         add_header Cache-Control "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private, no-store, no-cache, must-revalidate, proxy-revalidate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location /fincld-acteg/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location /param-web/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location /acten-web/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("为了保证 access.log 和 error.log 大小，需要对 nginx 日志进行按日切割，保留最近一个月的日志，需要由定时任务每日 23 点 59 分执行以下脚本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("yesterday")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" +%d"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LOG_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/home/ap/caec/logs/nginx'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LOG_PATH_BAK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("access."),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${yesterday}")]),t._v(".log\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LOG_PATH_ERROR_BAK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("error."),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${yesterday}")]),t._v(".log\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${LOG_HOME}")]),t._v("/access.log "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${LOG_HOME}")]),t._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${LOG_PATH_BAK}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${LOG_HOME}")]),t._v("/error.log "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${LOG_HOME}")]),t._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${LOG_PATH_ERROR_BAK}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" -USR1 "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /home/ap/caec/nginx/logs/nginx.pid"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" -R "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("755")]),t._v(" split_nginx_logs.sh\n配置nginx日志定时任务\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("crontab")]),t._v(" -e\n写入\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" * * * /home/ap/caec/nginx/logs/split_nginx_logs.sh\n保存\n运行crontab -l查看配置是否正确\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("root用户安装启动nginx\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf soft/pcre-8.38.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" pcre-8.38\n./configure "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf  soft/zlib-1.2.11.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" zlib-1.2.11\n./configure "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf soft/nginx-1.14.0.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-1.14.0\n./configure --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/ap/caec/nginx --with-http_stub_status_module --with-pcre"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/pcre-8.38 --with-zlib"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/zlib-1.2.11\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("普通用户启动nginx\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf soft/pcre-8.38.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" pcre-8.38\n./configure "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf  soft/zlib-1.2.11.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" zlib-1.2.11\n./configure "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf soft/nginx-1.14.0.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-1.14.0\n./configure --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/ap/caec/nginx --with-http_stub_status_module --with-pcre"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/pcre-8.38 --with-zlib"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/zlib-1.2.11\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/ap/caec/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R caec:caec nginx\n")])])]),n("p",[t._v("进入 caec 用户，修改 nginx 配置文件：/home/ap/caec/nginx/conf/nginx.conf")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("user caec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nworker_processes "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nerror_log /home/ap/caec/nginx/logs/error.log error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\npid /home/ap/caec/nginx/logs/nginx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" worker_connections "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\ninclude mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndefault_type application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\naccess_log /home/ap/caec/nginx/logs/access.log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsendfile on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nkeepalive_timeout 60s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nclient_max_body_size 100M"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nclient_body_buffer_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nfastcgi_intercept_errors on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nupstream dynamic "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nserver 实际ip:8101 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("maxfails")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("fail_timeout")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("40s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nlisten "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8088")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserver_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlocation / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nproxy_set_header  Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproxy_set_header  X-real-ip "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproxy_set_header  X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nroot /home/ap/caec/caec_static"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nindex index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nif"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" ~* .*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?:htm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nadd_header Cache-Control "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private, no-store, no-cache, must-revalidate, proxy-revalidate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nlocation /fincld-acteg/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nlocation /param-weeb/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nlocation /acten-web/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("修改完配置后，进入/home/ap/caec/nginx/sbin 目录，运行./nginx 启动 nginx")]),t._v(" "),n("p",[t._v("访问 ip:8088，出现首页则说明安装成功")]),t._v(" "),n("p",[t._v("Nginx 安装配置 Lua 支持\n下载最新的 luajit 和 ngx_devel_kit 以及 lua-nginx-module 解压")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf ngx_devel_kit-0.2.19.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf lua-nginx-module-0.10.12.tar.gz\n")])])]),n("p",[t._v("编译安装 LuaJIT，即 Lua 及时编译器")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf LuaJIT-2.0.4.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" LuaJIT-2.0.4/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),n("p",[t._v("重新安装 nginx")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/nginx-1.18.0\n./configure --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx --with-http_stub_status_module --add-module"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/ngx_devel_kit-0.2.19/ --add-module"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/lua-nginx-module-0.10.13/ --with-pcre"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/pcre-8.38 --with-zlib"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/zlib-1.2.11\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),n("p",[t._v("在 nginx 配置文件中加上：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("lua_shared_dict prometheus_metrics 10M"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlua_package_path "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/nginx-lua-prometheus/?.lua;;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ninit_worker_by_lua_block "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  prometheus "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" require"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus_metrics"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  metric_requests "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" prometheus:counter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx_http_requests_total"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Number of HTTP requests"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  metric_latency "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" prometheus:histogram"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx_http_request_duration_seconds"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HTTP request latency"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  metric_connections "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" prometheus:gauge"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx_http_connections"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Number of HTTP connections"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nlog_by_lua_block "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  metric_requests:inc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ngx.var.server_name, ngx.var.status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  metric_latency:observe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tonumber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx.var.request_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ngx.var.server_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9145")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  allow "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/16"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  deny all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location /metrics "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    content_by_lua_block "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      metric_connections:set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx.var.connections_reading, "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reading"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      metric_connections:set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx.var.connections_waiting, "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"waiting"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      metric_connections:set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx.var.connections_writing, "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"writing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      prometheus:collect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("重启")]),t._v(" "),n("p",[t._v("报错如下：\n解决：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /lib64\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/local/lib/libluajit-5.1.so.2 /lib64/libluajit-5.1.so.2\nll libluajit-5.1.so.2\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/nginx-1.18.0\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/LuaJIT/lib"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/ld.so.conf\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/local/nginx/sbin\n./nginx -s reload\n")])])]),n("p",[t._v("nginx 配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#user caec;")]),t._v("\nworker_processes "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nerror_log /home/ap/caec/logs/nginx/error.log error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid /home/ap/caec/nginx/logs/nginx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  worker_connections "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  include mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  default_type application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  log_format main "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(" - "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user")]),t._v(" ["),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v("] - "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$upstream_addr")]),t._v(' "'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request")]),t._v("\" '")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(' "'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v("\" '")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\""),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v('" "'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for")]),t._v("\"'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  access_log /home/ap/caec/logs/nginx/access.log main "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("64k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  sendfile on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  keepalive_timeout 60s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  client_max_body_size 100M"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  client_body_buffer_size 128k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  fastcgi_intercept_errors on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  upstream dynamic "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.100")]),t._v(".67.148:8101"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.100")]),t._v(".67.149:8101"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8088")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy_set_header            Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      proxy_set_header            X-real-ip "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      proxy_set_header            X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      root /home/ap/caec/caec_static"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      index index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      if"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" ~* .*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?:htm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         add_header Cache-Control "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private, no-store, no-cache, must-revalidate, proxy-revalidate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location /fincld-acteg/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location /param-web/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location /acten-web/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy_pass http://dynamic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("nginx IP 漂移")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v("  /etc/keepalived/keepalived.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主配置")]),t._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   router_id LVS_DEVEL\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## keepalived 会定时执行脚本并对脚本执行的结果进行分析，动态调整 vrrp_instance 的优先级。如果脚本执行结果为 0，并且 weight 配置的值大于 0，则优先级相应的增加。如果脚本执行结果非 0，并且 weight配置的值小于 0，则优先级相应的减少。其他情况，维持原本配置的优先级，即配置文件中 priority 对应的值。")]),t._v("\nvrrp_script chk_nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    script "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/keepalived/nginx_check.sh"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 检测 nginx 状态的脚本路径")]),t._v("\n    interval "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 检测时间间隔")]),t._v("\n    weight -20 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 如果条件成立，权重-20")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 定义虚拟路由， VI_1 为虚拟路由的标示符，自己定义名称")]),t._v("\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   state MASTER "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 主节点为 MASTER， 对应的备份节点为 BACKUP")]),t._v("\n   interface eth0 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 绑定虚拟 IP 的网络接口，与本机 IP 地址所在的网络接口相同， 我的是 eth0")]),t._v("\n   virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 虚拟路由的 ID 号， 两个节点设置必须一样， 可选 IP 最后一段使用, 相同的 VRID 为一个组，他将决定多播的 MAC 地址")]),t._v("\n   priority "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 节点优先级， 值范围 0-254， MASTER 要比 BACKUP 高")]),t._v("\n   nopreempt "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 优先级高的设置 nopreempt 解决异常恢复后再次抢占的问题")]),t._v("\n   advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 组播信息发送间隔，两个节点设置必须一样， 默认 1s")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 设置验证信息，两个节点必须一致")]),t._v("\nauthentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   auth_type PASS\n   auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 真实生产，按需求对应该过来")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 将 track_script 块加入 instance 配置块")]),t._v("\ntrack_script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   chk_nginx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 执行 Nginx 监控的服务")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟 IP 池, 两个节点设置必须一样")]),t._v("\nvirtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".50.130 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 虚拟 ip，可以定义多个")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/keepalived/keepalived.conf")]),t._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## keepalived 自带的邮件提醒需要开启 sendmail 服务。 建议用独立的监控或第三方 SMTP")]),t._v("\n   router_id LVS_DEVEL\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## keepalived 会定时执行脚本并对脚本执行的结果进行分析，动态调整 vrrp_instance 的优先级。如果脚本执行结果为 0，并且 weight 配置的值大于 0，则优先级相应的增加。如果脚本执行结果非 0，并且 weight配置的值小于 0，则优先级相应的减少。其他情况，维持原本配置的优先级，即配置文件中 priority 对应的值。")]),t._v("\nvrrp_script chk_nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nscript "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/keepalived/nginx_check.sh"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 检测 nginx 状态的脚本路径")]),t._v("\ninterval "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 检测时间间隔")]),t._v("\nweight -20 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 如果条件成立，权重-20")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 定义虚拟路由， VI_1 为虚拟路由的标示符，自己定义名称")]),t._v("\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   state MASTER "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 主节点为 MASTER， 对应的备份节点为 BACKUP")]),t._v("\n   interface eth0 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 绑定虚拟 IP 的网络接口，与本机 IP 地址所在的网络接口相同， 我的是 eth0")]),t._v("\n   virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 虚拟路由的 ID 号， 两个节点设置必须一样， 可选 IP 最后一段使用, 相同的 VRID 为一个组，他将决定多播的 MAC 地址")]),t._v("\n   priority "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 节点优先级， 值范围 0-254， MASTER 要比 BACKUP 高")]),t._v("\n   nopreempt "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 优先级高的设置 nopreempt 解决异常恢复后再次抢占的问题")]),t._v("\n   advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 组播信息发送间隔，两个节点设置必须一样， 默认 1s")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 设置验证信息，两个节点必须一致")]),t._v("\nauthentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   auth_type PASS\n   auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 真实生产，按需求对应该过来")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 将 track_script 块加入 instance 配置块")]),t._v("\ntrack_script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   chk_nginx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 执行 Nginx 监控的服务")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟 IP 池, 两个节点设置必须一样")]),t._v("\nvirtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".50.130 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 虚拟 ip，可以定义多个")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("(2)备配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("g"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/keepalived/keepalived.conf")]),t._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  router_id LVS_DEVEL\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvrrp_script chk_nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  script "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/keepalived/nginx_check.sh"')]),t._v("\n  interval "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  weight -20\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  state BACKUP\n  interface eth0\n  virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),t._v("\n  priority "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("\n  advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  auth_type PASS\n  auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\ntrack_script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  chk_nginx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nvirtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".50.130\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("755")]),t._v(" /etc/keepalived/nginx_check.sh\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("A")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -C nginx --no-header "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wc")]),t._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$A")]),t._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    /usr/local/nginx/sbin/nginx\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -C nginx --no-header "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wc")]),t._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pkill")]),t._v(" keepalived\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("）启动或者重启keepalived服务\nsystemctl restart keepalived\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);